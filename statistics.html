<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>消费统计 - 轻记账</title>
    <link href="https://cdn.jsdelivr.net/npm/tailwindcss@2.2.19/dist/tailwind.min.css" rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0-beta3/css/all.min.css">
    <link rel="stylesheet" href="./css/style.css">
    <link rel="stylesheet" href="./css/instagram-style.css">
    <!-- 引入Chart.js用于图表展示 -->
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/gsap/3.11.4/gsap.min.js"></script>
</head>
<body class="min-h-screen">
    <div class="container mx-auto px-4 py-6 max-w-md">
        <!-- 顶部导航 -->
        <div class="ins-card p-4 mb-6 flex items-center justify-between">
            <a href="./index.html" class="text-gray-600">
                <i class="fas fa-arrow-left"></i>
            </a>
            <h1 class="text-xl font-bold text-gray-800">消费统计</h1>
            <div class="w-6"></div> <!-- 占位元素，保持标题居中 -->
        </div>

        <!-- 时间范围选择 -->
        <div class="ins-card p-4 mb-6">
            <div class="flex justify-between items-center">
                <button class="ins-button py-1 px-3 text-sm rounded-full">本月</button>
                <button class="ins-button-outline py-1 px-3 text-sm rounded-full">上月</button>
                <button class="ins-button-outline py-1 px-3 text-sm rounded-full">三个月</button>
                <button class="ins-button-outline py-1 px-3 text-sm rounded-full">今年</button>
            </div>
        </div>

        <!-- 总览卡片 -->
        <div class="ins-card p-4 mb-6">
            <div class="flex justify-between items-center mb-3">
                <div>
                    <p class="text-xs text-gray-500">总收入</p>
                    <p class="text-lg font-bold text-green-500 income-text">¥3,250.00</p>
                </div>
                <div>
                    <p class="text-xs text-gray-500">总支出</p>
                    <p class="text-lg font-bold text-red-500 expense-text">¥1,840.50</p>
                </div>
                <div>
                    <p class="text-xs text-gray-500">结余</p>
                    <p class="text-lg font-bold text-blue-500 balance-text">¥1,409.50</p>
                </div>
            </div>
        </div>

        <!-- 支出分类饼图 -->
        <div class="ins-card p-4 mb-6">
            <h2 class="text-lg font-semibold text-gray-800 mb-4">支出分类</h2>
            <div class="h-64 relative">
                <canvas id="expenseChart"></canvas>
            </div>
            <!-- 图例 -->
            <div class="mt-4 grid grid-cols-2 gap-2">
                <div class="flex items-center">
                    <div class="w-3 h-3 rounded-full bg-red-400 mr-2"></div>
                    <span class="text-sm text-gray-600">餐饮 (35%)</span>
                </div>
                <div class="flex items-center">
                    <div class="w-3 h-3 rounded-full bg-blue-400 mr-2"></div>
                    <span class="text-sm text-gray-600">购物 (25%)</span>
                </div>
                <div class="flex items-center">
                    <div class="w-3 h-3 rounded-full bg-yellow-400 mr-2"></div>
                    <span class="text-sm text-gray-600">交通 (15%)</span>
                </div>
                <div class="flex items-center">
                    <div class="w-3 h-3 rounded-full bg-green-400 mr-2"></div>
                    <span class="text-sm text-gray-600">娱乐 (10%)</span>
                </div>
                <div class="flex items-center">
                    <div class="w-3 h-3 rounded-full bg-purple-400 mr-2"></div>
                    <span class="text-sm text-gray-600">居家 (8%)</span>
                </div>
                <div class="flex items-center">
                    <div class="w-3 h-3 rounded-full bg-gray-400 mr-2"></div>
                    <span class="text-sm text-gray-600">其他 (7%)</span>
                </div>
            </div>
        </div>

        <!-- 月度趋势图 -->
        <div class="ins-card p-4 mb-20">
            <h2 class="text-lg font-semibold text-gray-800 mb-4">月度趋势</h2>
            <div class="h-64 relative">
                <canvas id="trendChart"></canvas>
            </div>
        </div>

        <!-- 底部导航 -->
        <div class="fixed bottom-0 left-0 right-0 ins-nav py-3 px-6">
            <div class="flex justify-around max-w-md mx-auto">
                <a href="./index.html" class="flex flex-col items-center text-gray-500">
                    <i class="fas fa-home text-xl"></i>
                    <span class="text-xs mt-1">首页</span>
                </a>
                <a href="./transactions.html" class="flex flex-col items-center text-gray-500">
                    <i class="fas fa-list text-xl"></i>
                    <span class="text-xs mt-1">记录</span>
                </a>
                <a href="./statistics.html" class="flex flex-col items-center text-blue-600">
                    <i class="fas fa-chart-pie text-xl"></i>
                    <span class="text-xs mt-1">统计</span>
                </a>
                <a href="./settings.html" class="flex flex-col items-center text-gray-500">
                    <i class="fas fa-cog text-xl"></i>
                    <span class="text-xs mt-1">设置</span>
                </a>
            </div>
        </div>
    </div>

    <script src="./js/app.js"></script>
    <script src="./js/theme.js"></script>
    <script>
        // GSAP动画效果
        document.addEventListener('DOMContentLoaded', function() {
            // 顶部导航动画
            gsap.from('.ins-card:first-child', {duration: 0.6, y: -20, opacity: 0, ease: 'power3.out'});
            
            // 时间范围选择动画
            gsap.from('.ins-card:nth-child(2)', {duration: 0.6, y: 20, opacity: 0, delay: 0.2, ease: 'power2.out'});
            
            // 总览卡片动画
            gsap.from('.ins-card:nth-child(3)', {duration: 0.6, scale: 0.95, opacity: 0, delay: 0.3, ease: 'power2.out'});
            
            // 支出分类饼图动画
            gsap.from('.ins-card:nth-child(4)', {duration: 0.6, scale: 0.95, opacity: 0, delay: 0.4, ease: 'power2.out'});
            
            // 月度趋势图动画
            gsap.from('.ins-card:nth-child(5)', {duration: 0.6, scale: 0.95, opacity: 0, delay: 0.5, ease: 'power2.out'});
            
            // 底部导航动画
            gsap.from('.ins-nav', {duration: 0.6, y: 20, opacity: 0, delay: 0.6, ease: 'power2.out'});
            
            // 图表颜色适配主题
            function updateChartColors() {
                const isDark = document.documentElement.getAttribute('data-theme') === 'dark';
                
                // 更新饼图颜色
                if (window.expenseChart) {
                    window.expenseChart.data.datasets[0].backgroundColor = isDark ? 
                        [
                            'rgba(255, 92, 141, 0.7)',  // 红色
                            'rgba(100, 181, 246, 0.7)', // 蓝色
                            'rgba(255, 171, 64, 0.7)',  // 黄色
                            'rgba(105, 240, 174, 0.7)', // 绿色
                            'rgba(179, 136, 255, 0.7)', // 紫色
                            'rgba(158, 158, 158, 0.7)'  // 灰色
                        ] :
                        [
                            'rgba(239, 68, 68, 0.7)',   // 红色
                            'rgba(59, 130, 246, 0.7)',  // 蓝色
                            'rgba(245, 158, 11, 0.7)',  // 黄色
                            'rgba(16, 185, 129, 0.7)',  // 绿色
                            'rgba(139, 92, 246, 0.7)',  // 紫色
                            'rgba(156, 163, 175, 0.7)'  // 灰色
                        ];
                    
                    window.expenseChart.data.datasets[0].borderColor = isDark ? 
                        [
                            'rgba(255, 92, 141, 1)',  // 红色
                            'rgba(100, 181, 246, 1)', // 蓝色
                            'rgba(255, 171, 64, 1)',  // 黄色
                            'rgba(105, 240, 174, 1)', // 绿色
                            'rgba(179, 136, 255, 1)', // 紫色
                            'rgba(158, 158, 158, 1)'  // 灰色
                        ] :
                        [
                            'rgba(239, 68, 68, 1)',   // 红色
                            'rgba(59, 130, 246, 1)',  // 蓝色
                            'rgba(245, 158, 11, 1)',  // 黄色
                            'rgba(16, 185, 129, 1)',  // 绿色
                            'rgba(139, 92, 246, 1)',  // 紫色
                            'rgba(156, 163, 175, 1)'  // 灰色
                        ];
                    
                    window.expenseChart.update();
                }
                
                // 更新趋势图颜色
                if (window.trendChart) {
                    // 收入线条
                    window.trendChart.data.datasets[0].borderColor = isDark ? 'rgba(105, 240, 174, 1)' : 'rgba(16, 185, 129, 1)';
                    window.trendChart.data.datasets[0].backgroundColor = isDark ? 'rgba(105, 240, 174, 0.1)' : 'rgba(16, 185, 129, 0.1)';
                    
                    // 支出线条
                    window.trendChart.data.datasets[1].borderColor = isDark ? 'rgba(255, 92, 141, 1)' : 'rgba(239, 68, 68, 1)';
                    window.trendChart.data.datasets[1].backgroundColor = isDark ? 'rgba(255, 92, 141, 0.1)' : 'rgba(239, 68, 68, 0.1)';
                    
                    window.trendChart.update();
                }
            }
            
            // 监听主题变化
            const themeToggle = document.querySelector('.theme-toggle');
            if (themeToggle) {
                themeToggle.addEventListener('click', function() {
                    setTimeout(updateChartColors, 100);
                });
            }
            
            // 初始化时设置图表颜色
            setTimeout(updateChartColors, 100);
            
            // 将Chart实例保存到window对象中以便访问
            window.expenseChart = expenseChart;
            window.trendChart = trendChart;
        });
    </script>
    <script>
        // 支出分类饼图
        const expenseCtx = document.getElementById('expenseChart').getContext('2d');
        const expenseChart = new Chart(expenseCtx, {
            type: 'doughnut',
            data: {
                labels: ['餐饮', '购物', '交通', '娱乐', '居家', '其他'],
                datasets: [{
                    data: [35, 25, 15, 10, 8, 7],
                    backgroundColor: [
                        'rgba(239, 68, 68, 0.7)',
                        'rgba(59, 130, 246, 0.7)',
                        'rgba(245, 158, 11, 0.7)',
                        'rgba(16, 185, 129, 0.7)',
                        'rgba(139, 92, 246, 0.7)',
                        'rgba(156, 163, 175, 0.7)'
                    ],
                    borderColor: [
                        'rgba(239, 68, 68, 1)',
                        'rgba(59, 130, 246, 1)',
                        'rgba(245, 158, 11, 1)',
                        'rgba(16, 185, 129, 1)',
                        'rgba(139, 92, 246, 1)',
                        'rgba(156, 163, 175, 1)'
                    ],
                    borderWidth: 1
                }]
            },
            options: {
                responsive: true,
                maintainAspectRatio: false,
                plugins: {
                    legend: {
                        display: false
                    }
                },
                cutout: '70%'
            }
        });

        // 月度趋势图
        const trendCtx = document.getElementById('trendChart').getContext('2d');
        const trendChart = new Chart(trendCtx, {
            type: 'line',
            data: {
                labels: ['1月', '2月', '3月', '4月', '5月', '6月'],
                datasets: [
                    {
                        label: '收入',
                        data: [3000, 3200, 3100, 3300, 3150, 3250],
                        borderColor: 'rgba(16, 185, 129, 1)',
                        backgroundColor: 'rgba(16, 185, 129, 0.1)',
                        fill: true,
                        tension: 0.4
                    },
                    {
                        label: '支出',
                        data: [1800, 2100, 1950, 2000, 1750, 1840],
                        borderColor: 'rgba(239, 68, 68, 1)',
                        backgroundColor: 'rgba(239, 68, 68, 0.1)',
                        fill: true,
                        tension: 0.4
                    }
                ]
            },
            options: {
                responsive: true,
                maintainAspectRatio: false,
                plugins: {
                    legend: {
                        position: 'top',
                        labels: {
                            boxWidth: 10,
                            usePointStyle: true,
                            pointStyle: 'circle'
                        }
                    }
                },
                scales: {
                    y: {
                        beginAtZero: true,
                        grid: {
                            color: 'rgba(0, 0, 0, 0.05)'
                        }
                    },
                    x: {
                        grid: {
                            display: false
                        }
                    }
                }
            }
        });
    </script>
</body>
</html>